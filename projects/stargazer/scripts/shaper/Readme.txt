Настройка шейпера для STG в Linux.

По мотивам форума:
http://local.com.ua/forum/index.php?showtopic=7920

Настройка сводится к указанию сетевого интерфейса, обращенного к пользователю 
в скриптах shaper.sh, shaper.stop.sh, OnConnect и OnDisconnect, и уточнению 
скоростоей и тарифов в скрипте OnConnect (если нужно).

Скрипты сделаны для БД на файлах, однако, сделать их для БД на Firebird или 
MySQL не составит большого труда.

В OnConnect есть два типа шейпинга.
1. На основании тарифа. Т.е. для каждого тарифа у задана скорость и задано 
дефолтное значение, на случай отсутсвия тарифа в списке скоростей или 
забывчивости админа.
2. На основании Userdata0. В этом поле просто прописывается число равное 
скорости в kbit/sec. Также есть дефолтное значение скорости в 32 kbit/sec 
на случай отсутсвия в Userdata0 корректного значения.

В скрипте первый способ закомментирован. Для того чтобы выбрать один из них нужно
либо удалить, либо закомментировать строчики между

# ========= shaping by tariff ==========
.........
# ======= shaping by tariff end ========

и

# ========= shaping by userdata0 ==========
.........
# ======= shaping by userdata0 end ========


и нужную часть расскоментировать, если она закомментрована.

Скрипт shaper.sh должен быть выполнен один раз при загрузке системы.

Интерфейс обращенный к пользователю определяется в переменной
int_iface= 
(присутствует во всех 4-х файлах shaper.sh, shaper.stop.sh, OnConnect и 
OnDisconnect !!!)

Скорость по умолчанию в OnConnect в переменной default_speed

Зависимость скорости от тарифа задается в следующем фрагменте кода:
case $tariff in
    minimum)  speedkb=128kbit;;
    middle)   speedkb=256kbit;;
    maximum)  speedkb=512kbit;;
    *)        speedkb=$default_speed;;
esac

Т.е. тут нужно вместо minimum, ... maximum подставить имена ваших тарифов 
и соотв. скорость. Пользователи с тарифами не указанными в списке будут иметь 
дефолтную скорость.

Скорость ограничевается только для входящего тарафика, однако расширить 
эти скрипты для исходящего не составит труда.
